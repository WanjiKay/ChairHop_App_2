<div class="chat-index-page mt-5">
  <div class="container py-4">

    <!-- Header -->
    <div class="text-center mb-4">
      <h1>My Chats with Hopps</h1>
      <p class="text-muted">View all your conversations with our AI assistant</p>
    </div>

    <!-- New Chat Button -->
    <div class="text-center mb-4">
      <%= link_to new_chat_path, class: "btn btn-primary btn-lg" do %>
        <i class="fas fa-plus me-2"></i> Start New Chat
      <% end %>
    </div>

    <!-- General Chats Section -->
    <div class="mb-5">
      <h2 class="message-list-title">
        <i class="fas fa-comments me-2"></i>General Chats
      </h2>

      <% if @general_chats.any? %>
        <div class="message-list">
          <% @general_chats.each do |chat| %>
            <%= link_to chat_path(chat), class: "message-item text-decoration-none" do %>
              <div class="message-avatar">
                <%= image_tag "icons/favicon-96x96.png", class: "ai-avatar-img rounded-circle", alt: "Hopps" %>
              </div>
              <div class="message-content">
                <div class="message-header">
                  <h3 class="message-title">
                    <%= chat.title.present? ? chat.title : "Chat with Hopps" %>
                  </h3>
                  <span class="message-time">
                    <%= time_ago_in_words(chat.updated_at) %> ago
                  </span>
                </div>
                <p class="message-preview">
                  <% if chat.messages.any? %>
                    <%= truncate(chat.messages.last.content, length: 100) %>
                  <% else %>
                    No messages yet
                  <% end %>
                </p>
                <div class="message-meta">
                  <small>
                    <i class="fas fa-message me-1"></i>
                    <%= pluralize(chat.messages.count, 'message') %>
                  </small>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">
            <i class="fas fa-comments fa-4x"></i>
          </div>
          <h3>No General Chats Yet</h3>
          <p>Start a general chat to get help finding stylists and booking appointments</p>
          <%= link_to new_chat_path, class: "btn btn-primary mt-3" do %>
            <i class="fas fa-plus me-2"></i> Start General Chat
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Appointment-Related Chats Section -->
    <div class="mb-5">
      <h2 class="message-list-title">
        <i class="fas fa-calendar-check me-2"></i>Appointment Chats
      </h2>

      <% if @appointment_chats.any? %>
        <div class="message-list">
          <% @appointment_chats.each do |chat| %>
            <%= link_to chat_path(chat), class: "message-item text-decoration-none" do %>
              <div class="message-avatar">
                <%= image_tag "icons/favicon-96x96.png", class: "ai-avatar-img rounded-circle", alt: "Hopps" %>
              </div>
              <div class="message-content">
                <div class="message-header">
                  <h3 class="message-title">
                    <%= chat.title.present? ? chat.title : "Chat about Appointment" %>
                  </h3>
                  <span class="message-time">
                    <%= time_ago_in_words(chat.updated_at) %> ago
                  </span>
                </div>
                <p class="message-preview">
                  <% if chat.messages.any? %>
                    <%= truncate(chat.messages.last.content, length: 100) %>
                  <% else %>
                    No messages yet
                  <% end %>
                </p>
                <div class="message-meta">
                  <small>
                    <i class="fas fa-calendar me-1"></i>
                    <%= chat.appointment.salon %> - <%= chat.appointment.time.strftime("%b %d, %Y") if chat.appointment.time.present? %>
                  </small>
                  <small class="ms-3">
                    <i class="fas fa-message me-1"></i>
                    <%= pluralize(chat.messages.count, 'message') %>
                  </small>
                </div>
              </div>
              <div class="message-badge">
                <%= link_to appointment_path(chat.appointment), class: "badge bg-primary text-decoration-none", onclick: "event.stopPropagation();" do %>
                  View Appointment
                <% end %>
              </div>
            <% end %>
          <% end %>
        </div>
      <% else %>
        <div class="empty-state">
          <div class="empty-state-icon">
            <i class="fas fa-calendar-check fa-4x"></i>
          </div>
          <h3>No Appointment Chats Yet</h3>
          <p>When you start a chat from an appointment page, it will appear here</p>
        </div>
      <% end %>
    </div>

  </div>
</div>
