<div id="conversation_message_<%= conversation_message.id %>"
     class="message-wrapper <%= conversation_message.role == 'customer' ? 'customer-message' : 'stylist-message' %>">

  <% if conversation_message.role == 'stylist' %>
    <% if conversation_message.conversation.stylist.avatar.attached? %>
      <%= image_tag conversation_message.conversation.stylist.avatar, class: "stylist-avatar rounded-circle" %>
    <% else %>
      <%= image_tag "profile.png", class: "stylist-avatar rounded-circle", alt: "Stylist" %>
    <% end %>
  <% end %>

  <div class="message-bubble">
    <strong><%= conversation_message.role.capitalize %></strong>
    <% if conversation_message.content.present? %>
      <p class="mb-0"><%= simple_format(conversation_message.content) %></p>
    <% end %>
    <% if conversation_message.photos.attached? %>
      <div class="message-images mt-2">
        <% conversation_message.photos.each do |photo| %>
          <%= link_to photo.url, target: "_blank" do %>
            <%= image_tag photo, class: "message-image", style: "max-width: 300px; max-height: 300px; border-radius: 8px; display: block; margin-bottom: 0.5rem;" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>

  <% if conversation_message.role == 'customer' %>
    <% if conversation_message.conversation.customer.avatar.attached? %>
      <%= image_tag conversation_message.conversation.customer.avatar, class: "customer-avatar rounded-circle" %>
    <% else %>
      <%= image_tag "profile.png", class: "customer-avatar rounded-circle", alt: "Customer" %>
    <% end %>
  <% end %>

</div>
